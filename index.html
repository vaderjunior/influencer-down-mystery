<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oru Cucumber City Murder Mystery</title>
    <style>
        :root {
            --blood-red: #a80404;
            --dark-red: #5a0000;
            --paper: #e6e6e6;
            --ink: #111;
            --gold: #d4af37;
            --bg: #0d0d0d;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg);
            color: var(--paper);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        /* --- UTILS --- */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .red-text { color: var(--blood-red); font-weight: bold; }
        .gold-text { color: var(--gold); }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }

        /* --- LOGIN SCREEN --- */
        .login-screen {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle, #1a1a1a 0%, #000 100%);
            padding: 20px;
        }

        h1 {
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--blood-red);
            text-shadow: 2px 2px 0px #000;
            margin-bottom: 5px;
            text-align: center;
            border-bottom: 2px solid var(--blood-red);
            padding-bottom: 10px;
        }

        .subtitle { font-size: 0.9rem; color: #888; margin-bottom: 30px; font-style: italic; }

        input[type="number"], input[type="text"] {
            background: #222;
            border: 1px solid #444;
            color: var(--gold);
            padding: 15px;
            font-size: 1.5rem;
            text-align: center;
            width: 100%;
            max-width: 300px;
            margin-bottom: 15px;
            font-family: inherit;
            border-radius: 4px;
            outline: none;
            letter-spacing: 5px;
        }

        button {
            background: var(--blood-red);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1rem;
            text-transform: uppercase;
            font-weight: bold;
            cursor: pointer;
            letter-spacing: 1px;
            border-radius: 4px;
            box-shadow: 0 4px 0 var(--dark-red);
            transition: all 0.2s;
            width: 100%;
            max-width: 300px;
        }

        button:active { transform: translateY(4px); box-shadow: none; }

        /* --- DASHBOARDS --- */
        .dashboard-header {
            border-bottom: 2px solid var(--blood-red);
            padding-bottom: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .char-name { font-size: 1.1rem; color: var(--gold); font-weight: bold; }
        .logout-btn { background: #333; font-size: 0.7rem; padding: 5px 10px; box-shadow: none; width: auto; }

        .card {
            background: #1a1a1a;
            border: 1px solid #333;
            margin-bottom: 15px;
            border-radius: 6px;
            overflow: hidden;
        }

        .card-header {
            padding: 15px;
            background: #222;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-bottom: 1px solid #333;
        }

        .card-title { font-weight: bold; color: #ddd; }
        .status-icon { font-size: 1.2rem; }

        .card-content {
            padding: 20px;
            background: var(--paper);
            color: var(--ink);
            display: none; 
            border-top: 4px solid var(--blood-red);
            line-height: 1.5;
        }

        .card.open .card-content { display: block; }
        .card.locked { opacity: 0.7; }
        .card.locked .card-header { background: #111; color: #666; cursor: default; }

        .clue-box {
            background: #fff;
            border: 2px dashed #000;
            padding: 15px;
            margin: 15px 0;
            background-color: #fff9e6;
        }

        /* --- ADMIN SPECIFIC --- */
        .admin-panel { background: #111; min-height: 100vh; }
        
        .guide-step {
            border-left: 3px solid var(--gold);
            padding-left: 10px;
            margin-bottom: 15px;
        }
        .guide-say {
            font-style: italic;
            background: #e1e1e1;
            padding: 10px;
            border-radius: 4px;
            margin-top: 5px;
            color: #000;
        }

        details.master-row { background: #222; margin-bottom: 10px; border: 1px solid #444; border-radius: 4px; }
        summary { padding: 15px; cursor: pointer; list-style: none; font-weight: bold; display: flex; justify-content: space-between; color: var(--gold); }
        summary::-webkit-details-marker { display: none; }
        .master-detail-content { padding: 15px; background: #151515; border-top: 1px solid #444; color: #ccc; font-size: 0.9rem; }
        .master-label { color: #888; font-size: 0.8rem; text-transform: uppercase; margin-top: 10px; display: block; border-bottom: 1px solid #333; }

        .timer-display {
            font-size: 2rem; color: var(--gold); text-align: center; 
            background: #000; padding: 10px; border: 1px solid #333; margin: 10px 0;
            font-family: monospace;
        }

        .host-controls { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; margin-bottom: 20px; }
        .host-controls button { width: 100%; font-size: 0.8rem; }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-box {
            background: #222; border: 2px solid var(--blood-red);
            padding: 20px; width: 90%; max-width: 400px; text-align: center;
        }

        .flavor-text { font-style: italic; color: #555; font-size: 0.9em; margin-bottom: 10px; display: block; }
        
        /* TOXICOLOGY REPORT STYLE */
        .toxic-report-btn {
            background: #fff; color: #000; font-family: sans-serif; 
            border: 2px solid #000; margin-bottom: 15px;
        }
        .report-paper {
            background: #fff; color: #000; padding: 15px; text-align: left; 
            font-family: 'Arial', sans-serif; position: relative;
        }
        .report-header { border-bottom: 2px solid #000; margin-bottom: 10px; padding-bottom: 5px;}
        .report-stamp {
            position: absolute; bottom: 10px; right: 10px; 
            border: 3px solid var(--blood-red); color: var(--blood-red);
            padding: 5px; font-weight: bold; transform: rotate(-15deg);
            opacity: 0.5;
        }

    </style>
</head>
<body>

    <!-- 1. LOGIN SCREEN -->
    <div id="loginView" class="login-screen">
        <h1>A Cucumber City<br>Murder Mystery</h1>
        <p class="subtitle">Enter your 5-digit Access Code</p>
        <input type="number" id="pinInput" placeholder="PIN CODE">
        <button onclick="handleLogin()">Unlock File</button>
        <p id="loginError" class="red-text hidden" style="margin-top:10px;">Access Denied</p>
    </div>

    <!-- 2. PLAYER DASHBOARD -->
    <div id="playerView" class="container hidden">
        <div class="dashboard-header">
            <div>
                <span style="font-size:0.7rem; color:#888;">CURRENT PROFILE:</span><br>
                <span id="playerDisplayName" class="char-name">Name</span>
            </div>
            <button class="logout-btn" onclick="location.reload()">Exit</button>
        </div>

        <!-- Pre-Game -->
        <div class="card open">
            <div class="card-header">
                <span class="card-title">0. CONFIDENTIAL DOSSIER</span>
                <span class="status-icon">ðŸ”“</span>
            </div>
            <div class="card-content">
                <p id="preGameText">Loading...</p>
            </div>
        </div>

        <!-- Round 1 -->
        <div class="card locked" id="card1">
            <div class="card-header" onclick="tryUnlock(1)">
                <span class="card-title">ROUND 1: The Alibi</span>
                <span class="status-icon" id="lock1">ðŸ”’</span>
            </div>
            <div class="card-content" id="content1">
                <h3 class="red-text">ROUND 1: FIRST IMPRESSIONS</h3>
                <span class="flavor-text">The body has been found. The police are delayed by the snow. Suspicion is in the air.</span>
                <hr>
                <p><strong>WHAT YOU SAY:</strong><br><span id="r1Reveal">...</span></p>
                <div class="clue-box">
                    <strong>WHAT YOU HIDE:</strong><br><span id="r1Secret">...</span>
                </div>
            </div>
        </div>

        <!-- Round 2 -->
        <div class="card locked" id="card2">
            <div class="card-header" onclick="tryUnlock(2)">
                <span class="card-title">ROUND 2: Secrets</span>
                <span class="status-icon" id="lock2">ðŸ”’</span>
            </div>
            <div class="card-content" id="content2">
                <h3 class="red-text">ROUND 2: DIRTY LAUNDRY</h3>
                <span class="flavor-text">The initial shock is wearing off. Now, people are pointing fingers.</span>
                <hr>
                <p><strong>YOUR NEW INTEL:</strong><br><span id="r2Clue">...</span></p>
                <div class="clue-box">
                    <strong>YOUR BEHAVIOR:</strong><br><span id="r2Strategy">...</span>
                </div>
            </div>
        </div>

        <!-- Round 3 -->
        <div class="card locked" id="card3">
            <div class="card-header" onclick="tryUnlock(3)">
                <span class="card-title">ROUND 3: The Truth</span>
                <span class="status-icon" id="lock3">ðŸ”’</span>
            </div>
            <div class="card-content" id="content3">
                <h3 class="red-text">ROUND 3: ACCUSATION</h3>
                <span class="flavor-text">The motive is clear. It's time to vote.</span>
                <hr>
                
                <!-- VISUAL CLUE BUTTON -->
                <button class="toxic-report-btn" onclick="showReport()">ðŸ“„ VIEW TOXICOLOGY REPORT</button>
                
                <p><strong>YOUR FINAL CARD:</strong><br><span id="r3Text">...</span></p>
                <p style="text-align:center; font-weight:bold; margin-top:20px;">DISCUSS & VOTE NOW</p>
            </div>
        </div>
    </div>

    <!-- 3. HOST ADMIN DASHBOARD -->
    <div id="adminView" class="container admin-panel hidden">
        <div class="dashboard-header">
            <span class="char-name">HOST CONTROL PANEL</span>
            <button class="logout-btn" onclick="location.reload()">Log Out</button>
        </div>

        <div class="timer-display" id="timer">00:00</div>
        <div class="host-controls">
            <button onclick="startTimer(15)">15 Min</button>
            <button onclick="startTimer(20)">20 Min</button>
            <button onclick="stopTimer()" style="background:#444">Stop</button>
        </div>

        <!-- ADMIN TAB: GAME STATUS -->
        <div class="card open">
            <div class="card-header"><span class="card-title">1. ROUND PASSWORDS</span></div>
            <div class="card-content">
                <p>Announce these to unlock rounds:</p>
                <ul>
                    <li>Start Round 1: <strong class="red-text">START</strong></li>
                    <li>Start Round 2: <strong class="red-text">SNOW</strong></li>
                    <li>Start Round 3: <strong class="red-text">TRUTH</strong></li>
                </ul>
            </div>
        </div>

        <!-- ADMIN TAB: GUIDE -->
        <div class="card">
            <div class="card-header" onclick="this.parentElement.classList.toggle('open')">
                <span class="card-title">2. HOSTING SCRIPT</span>
                <span>â–¼</span>
            </div>
            <div class="card-content">
                <div class="guide-step">
                    <strong>STEP 1: Start Round 1</strong><br>
                    Password: <strong>START</strong><br>
                    <div class="guide-say">"Introduce yourselves. Where were you when Rahul died?"</div>
                </div>

                <div class="guide-step">
                    <strong>STEP 2: Start Round 2</strong><br>
                    Password: <strong>SNOW</strong><br>
                    <div class="guide-say">"Check your phones. You have new dirt on someone. SHARE IT."</div>
                </div>

                <div class="guide-step">
                    <strong>STEP 3: Start Round 3</strong><br>
                    Password: <strong>TRUTH</strong><br>
                    <div class="guide-say">"The Toxicology Report is in. Check your Round 3 folder. Look at the evidence."</div>
                </div>

                <div class="guide-step">
                    <strong>STEP 4: Solution</strong><br>
                    <div class="guide-say">"Killer: <strong>Devi</strong>. She gave him sleeping pills to hack his phone. It reacted with Lakshmi's Paracetamol."</div>
                </div>
            </div>
        </div>

        <!-- ADMIN TAB: MASTER LIST -->
        <div class="card">
            <div class="card-header" onclick="this.parentElement.classList.toggle('open')">
                <span class="card-title">3. MASTER DOSSIER</span>
                <span>â–¼</span>
            </div>
            <div class="card-content" id="masterListContainer"></div>
        </div>
    </div>

    <!-- 4. MODALS -->
    
    <!-- Password Modal -->
    <div id="passwordModal" class="modal-overlay hidden">
        <div class="modal-box">
            <h3>Enter Round Password</h3>
            <input type="text" id="roundPasswordInput" placeholder="PASSWORD">
            <button onclick="checkPassword()">Unlock</button>
            <p id="pwdError" class="red-text hidden">Wrong Password</p>
            <button onclick="closeModal()" style="background:transparent; border:none; margin-top:10px; color:#888;">Cancel</button>
        </div>
    </div>

    <!-- Report Modal -->
    <div id="reportModal" class="modal-overlay hidden">
        <div class="modal-box" style="background:white; color:black; max-width:500px;">
            <div class="report-paper">
                <div class="report-header">
                    <h2>LAB TOXICOLOGY</h2>
                    <p>Date: Dec 3, 2025 | Ref: #8839</p>
                </div>
                <h3>SUBJECT: RAHUL 'RICHIE' NAIR</h3>
                <p><strong>Substances detected in blood sample:</strong></p>
                <ul>
                    <li>Alcohol (Ethanol): <span style="color:red">HIGH</span></li>
                    <li>Paracetamol: <span style="color:orange">DETECTED</span></li>
                    <li>Benzodiazepines: <span style="color:red; font-weight:bold;">LETHAL CONCENTRATION</span></li>
                </ul>
                <p style="font-size:0.8rem; margin-top:20px;">*Note: Interaction between Benzos, Alcohol, and Paracetamol caused cardiac arrest.</p>
                <div class="report-stamp">CONFIDENTIAL EVIDENCE</div>
            </div>
            <button onclick="document.getElementById('reportModal').classList.add('hidden')" style="margin-top:10px;">CLOSE EVIDENCE</button>
        </div>
    </div>

    <script>
        // --- GAME DATA ---
        const ROUND_PASSWORDS = { 1: "START", 2: "SNOW", 3: "TRUTH" };

        const CHARACTERS = {
            "12093": {
                name: "Arjun",
                role: "The Wannabe Influencer",
                pre: "You are Rahul's childhood friend, but let's be real, you are here for the content. You have 15k followers, mostly bought. You are vain, obsessed with your hair, and check your reflection constantly.",
                r1_rev: "I was setting up my ring light in the living room. The lighting in this Villa is tragic. I didn't even go to the kitchen.",
                r1_sec: "You were actually jealous. Rahul called you a 'clout chaser' yesterday. You hate that he was right.",
                r2_clue: "I saw Varun begging Rahul for money in the hallway. He was literally crying. It was pathetic content.",
                r2_strat: "If anyone asks why you are filming, say 'This is True Crime content! It's going to go viral!'",
                r3_text: "ALIBI PROOF: Your Instagram Live timestamp proves you were online and ranting to your followers when the drink was poured. You are innocent."
            },
            // PRIYA -> DEVI (Name changed)
            "88976": {
                name: "Devi",
                role: "The Unsung Genius",
                pre: "You are the batch topper doing your PhD. You survive on caffeine. Rahul copied your code in 3rd year and is now a millionaire. It burns you inside. You are exhausted.",
                r1_rev: "I was in the library reading. I have a thesis defense next week. I don't have time for this drama.",
                r1_sec: "YOU ARE THE KILLER. You crushed sleeping pills into his drink. You just wanted to knock him out to delete the stolen code from his phone. ACT NORMAL.",
                r2_clue: "Deflect attention! Tell everyone: 'I saw Divya crying in the bathroom saying she wished he was dead!'",
                r2_strat: "If asked about your relationship with Rahul, say you were just 'friendly classmates'. Blame your nerves on PhD stress.",
                r3_text: "THE SLIP UP: Someone found a burnt piece of paper. It looks like code. CLAIM IT IS YOURS. Say Rahul stole it years ago."
            },
            "45221": {
                name: "Deepak",
                role: "The Gym Bro",
                pre: "You believe the German diet is 90% carbs. You brought your own protein powder. You think Rahul is physically weak. You spend most of your time converting Euros to Rupees.",
                r1_rev: "I was doing pushups on the balcony. The cold air increases testosterone.",
                r1_sec: "You stole Rahul's Rolex AFTER he collapsed. It's hidden in your jar of Creatine.",
                r2_clue: "I saw Sahil spitting in Rahul's food earlier. He called him a 'Capitalist Pig'. That sounds like motive to me, bro.",
                r2_strat: "Flex your muscles when you talk. Suspect anyone who looks weak.",
                r3_text: "ALIBI: You are a thief, not a killer. Admit to the watch if pressed, but deny the murder."
            },
            "99823": {
                name: "Anjali",
                role: "The Gossip Queen",
                pre: "You know everyone's secrets. You are the admin of the batch WhatsApp group. You pretend to be sweet, but you live for the drama. You are currently sipping tea.",
                r1_rev: "I was in the kitchen, but I was facing the window! I was... taking a selfie.",
                r1_sec: "You saw Devi hovering near the drinks table looking sweaty and nervous. Let the tension build before revealing it.",
                r2_clue: "I heard Rahul on the phone yelling at Varun. Something about 'Bitcoin' and 'Lost it all'. Varun is broke, guys.",
                r2_strat: "Stir the pot! Say 'Wait, didn't I hear someone say something suspicious?'",
                r3_text: "CRITICAL MEMORY: 'Wait... I remember Rahul complaining his drink tasted chalky. Like medicine. Not like poison... but like pills.' Look at Lakshmi!"
            },
            "77612": {
                name: "Freddy (YOU)",
                role: "The 'German' Expert",
                pre: "You correct everyone's pronunciation of 'GlÃ¼hwein'. You are annoyed because Rahul refused to pay the Pfand. You like rules.",
                r1_rev: "I was checking the thermostat. Everyone keeps touching it! It must be exactly 21 degrees.",
                r1_sec: "You are actually furious that Rahul didn't pay his share of the Airbnb. You are stuck with the bill.",
                r2_clue: "I found a receipt in the trash for 'Strong Sleeping Pills'. It belongs to Devi.",
                r2_strat: "Act superior. Correct people's grammar. Complain about the mess.",
                r3_text: "ALIBI: You were on the phone with the pizza delivery guy arguing about the delivery fee."
            },
            "33409": {
                name: "Lakshmi",
                role: "The Mother Hen",
                pre: "You carried 5kg of pickles in your luggage. You have a full pharmacy in your handbag. You are Rahul's distant cousin.",
                r1_rev: "I was unpacking the pickles. Rahul looked pale earlier, I told him to eat properly.",
                r1_sec: "You gave Rahul a Paracetamol about 20 minutes before he died. Now you are terrified it reacted with the alcohol!",
                r2_clue: "Defend yourself! 'I gave him a paracetamol! Not poison! Check the strip in my bag!'",
                r2_strat: "Force feed people snacks while interrogating them.",
                r3_text: "OBSERVATION: 'I noticed Devi asked me earlier if I had anything really strong for insomnia. I said no... so where did she get pills?'"
            },
            "77102": {
                name: "Varun",
                role: "The Crypto Guy",
                pre: "You act rich. You rented a BMW for this trip. In reality, you lost all your money on a meme coin. You owe Rahul â‚¬5,000.",
                r1_rev: "I was checking the markets. Crypto never sleeps, bro. To the moon!",
                r1_sec: "Rahul threatened to expose you as a fraud if you didn't pay him tonight. You are desperate.",
                r2_clue: "Deflect blame to Sahil! 'He hates rich people! He probably killed him to smash the patriarchy!'",
                r2_strat: "Look nervous. Check your phone constantly.",
                r3_text: "ALIBI: Your phone shows you were on a Zoom call with your angry parents begging for money at the exact moment of death."
            },
            "22918": {
                name: "Meera",
                role: "The Quiet Artist",
                pre: "You are the 'weird' one. You wear oversized clothes and sketch people. You find death 'fascinating'.",
                r1_rev: "I was sketching the fire... the flames were dancing.",
                r1_sec: "You saw Deepak steal the watch from the body, but you haven't said anything. It's a social experiment.",
                r2_clue: "I saw Devi throw something into the fire right after Rahul fell. It looked like a wrapper.",
                r2_strat: "Stare at people intensely. If they ask why, say 'I am capturing your aura of guilt.'",
                r3_text: "THE REVEAL: Show your sketchbook (mime it). 'I drew the room 30 minutes ago. Devi is standing right next to Rahul's cup.'"
            },
            "55067": {
                name: "Jose",
                role: "The Party Animal",
                pre: "You brought 3 bottles of Old Monk. You are slightly drunk. You think every problem can be solved with a drink.",
                r1_rev: "I poured the drinks! Cheers! But I poured from the same bottle for everyone! I didn't poison it!",
                r1_sec: "You were too drunk to notice if someone slipped something into the cup after you poured it.",
                r2_clue: "Rahul was complaining of a headache. I saw Lakshmi give him a pill... but I also saw Devi hand him a glass of water.",
                r2_strat: "Offer everyone a drink, even the police. Slur your words slightly.",
                r3_text: "DEFENSE: 'If I wanted to kill him, I would have challenged him to a drinking contest. I wouldn't waste good wine!'"
            },
            "66123": {
                name: "Sahil",
                role: "The Activist",
                pre: "You study Sociology. You hate capitalism and Rahul's 'startup bro' energy. You think his wealth is stolen from the working class.",
                r1_rev: "I was in the bathroom. Rahul represents everything wrong with the system.",
                r1_sec: "You wrote 'THIEF' in lipstick on Rahul's mirror earlier to scare him.",
                r2_clue: "Reveal that Manu was trying to hack Rahul's phone! 'I saw Manu on his laptop trying to break into Rahul's cloud!'",
                r2_strat: "Lecture people. Use words like 'Bourgeoisie' and 'Oppression'.",
                r3_text: "DEFENSE: 'I wanted to destroy his reputation, not his body. Violence is the tool of the oppressor.'"
            },
            "10101": {
                name: "Manu",
                role: "The Techie",
                pre: "You are the IT guy. You fixed the Airbnb Wi-Fi. You are socially awkward and prefer computers to humans.",
                r1_rev: "The wifi here is terrible. 5Mbps? Disgusting. I was rebooting the router.",
                r1_sec: "You know Rahul's app code was actually stolen. You were hacking him to get evidence.",
                r2_clue: "I checked the router logs. Everyone was online... except Devi. She was offline for 20 minutes right before the murder.",
                r2_strat: "Complain about the tech. 'Who set up this Alexa? It's a security nightmare.'",
                r3_text: "BIG REVEAL: 'I hacked Rahul's email. He sent an email to Devi yesterday titled 'Legal Threat'."
            },
            "40404": {
                name: "Divya",
                role: "The Ex-Girlfriend",
                pre: "You dated Rahul for 2 years. He dumped you via WhatsApp. You are emotional, dramatic, and your mascara is running.",
                r1_rev: "I was crying on the stairs! *Sob* He was a jerk, but I loved him! *Sob*",
                r1_sec: "You still have a key to his apartment in Kochi. You were planning to break in and steal his cat.",
                r2_clue: "Suspicion: Admit you sent him a text saying 'You will pay for this'. It looks bad, but you meant emotionally!",
                r2_strat: "Make everything about your relationship. Cry loudly if accused.",
                r3_text: "ALIBI: Lakshmi was comforting you on the stairs when the body fell. She can vouch for you."
            }
        };

        // --- GAME LOGIC ---
        let currentUser = null;
        let pendingRound = 0;
        let timerInterval;

        function getEl(id) { return document.getElementById(id); }

        function handleLogin() {
            const input = getEl('pinInput').value.trim();
            const error = getEl('loginError');

            if (input === '6969') {
                getEl('loginView').classList.add('hidden');
                getEl('adminView').classList.remove('hidden');
                renderMasterList();
                return;
            }

            if (CHARACTERS[input]) {
                currentUser = CHARACTERS[input];
                loadPlayerData();
                getEl('loginView').classList.add('hidden');
                getEl('playerView').classList.remove('hidden');
                error.classList.add('hidden');
            } else {
                error.classList.remove('hidden');
            }
        }

        function loadPlayerData() {
            getEl('playerDisplayName').innerText = currentUser.role + " (" + currentUser.name + ")";
            getEl('preGameText').innerHTML = currentUser.pre;
            getEl('r1Reveal').innerHTML = currentUser.r1_rev;
            getEl('r1Secret').innerHTML = currentUser.r1_sec;
            getEl('r2Clue').innerHTML = currentUser.r2_clue;
            getEl('r2Strategy').innerHTML = currentUser.r2_strat;
            getEl('r3Text').innerHTML = currentUser.r3_text;
        }

        function renderMasterList() {
            const container = getEl('masterListContainer');
            container.innerHTML = "";
            
            for (const [pin, char] of Object.entries(CHARACTERS)) {
                let html = `
                    <details class="master-row">
                        <summary><span class="red-text">${char.name}</span> (${char.role}) - PIN: ${pin}</summary>
                        <div class="master-detail-content">
                            <span class="master-label">Briefing (R0):</span><div>${char.pre}</div>
                            <span class="master-label">R1 Reveal:</span><div>${char.r1_rev}</div>
                            <span class="master-label">R1 Secret:</span><div>${char.r1_sec}</div>
                            <span class="master-label">R2 Clue:</span><div>${char.r2_clue}</div>
                            <span class="master-label">R3 Final:</span><div>${char.r3_text}</div>
                        </div>
                    </details>
                `;
                container.innerHTML += html;
            }
        }

        function showReport() {
            document.getElementById('reportModal').classList.remove('hidden');
        }

        function tryUnlock(roundNum) {
            const card = getEl('card' + roundNum);
            if (card.classList.contains('open')) { card.classList.remove('open'); return; }
            pendingRound = roundNum;
            getEl('passwordModal').classList.remove('hidden');
            getEl('roundPasswordInput').value = "";
            getEl('roundPasswordInput').focus();
            getEl('pwdError').classList.add('hidden');
        }

        function checkPassword() {
            const input = getEl('roundPasswordInput').value.trim().toUpperCase();
            if (input === ROUND_PASSWORDS[pendingRound]) {
                getEl('card' + pendingRound).classList.remove('locked');
                getEl('card' + pendingRound).classList.add('open');
                getEl('passwordModal').classList.add('hidden');
            } else {
                getEl('pwdError').classList.remove('hidden');
            }
        }

        function closeModal() { getEl('passwordModal').classList.add('hidden'); }
        
        function startTimer(minutes) {
            stopTimer();
            let seconds = minutes * 60;
            updateTimerDisplay(seconds);
            timerInterval = setInterval(() => {
                seconds--;
                updateTimerDisplay(seconds);
                if (seconds <= 0) { stopTimer(); alert("Time is up!"); }
            }, 1000);
        }

        function stopTimer() { clearInterval(timerInterval); }
        function updateTimerDisplay(seconds) {
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            getEl('timer').innerText = `${m}:${s}`;
        }

        getEl('pinInput').addEventListener("keypress", (e) => { if (e.key === "Enter") handleLogin(); });
        getEl('roundPasswordInput').addEventListener("keypress", (e) => { if (e.key === "Enter") checkPassword(); });

    </script>
</body>
</html>
